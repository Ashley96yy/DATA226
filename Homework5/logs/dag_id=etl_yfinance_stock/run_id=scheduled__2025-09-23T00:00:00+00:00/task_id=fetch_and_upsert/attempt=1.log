[2025-09-24T00:00:02.524+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2025-09-24T00:00:02.532+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_yfinance_stock.fetch_and_upsert scheduled__2025-09-23T00:00:00+00:00 [queued]>
[2025-09-24T00:00:02.534+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_yfinance_stock.fetch_and_upsert scheduled__2025-09-23T00:00:00+00:00 [queued]>
[2025-09-24T00:00:02.534+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 2
[2025-09-24T00:00:02.538+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): fetch_and_upsert> on 2025-09-23 00:00:00+00:00
[2025-09-24T00:00:02.541+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=48309) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2025-09-24T00:00:02.541+0000] {standard_task_runner.py:64} INFO - Started process 48315 to run task
[2025-09-24T00:00:02.542+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'etl_yfinance_stock', 'fetch_and_upsert', 'scheduled__2025-09-23T00:00:00+00:00', '--job-id', '366', '--raw', '--subdir', 'DAGS_FOLDER/etl_yfinance_stock.py', '--cfg-path', '/tmp/tmpmjwbgmxs']
[2025-09-24T00:00:02.542+0000] {standard_task_runner.py:91} INFO - Job 366: Subtask fetch_and_upsert
[2025-09-24T00:00:02.559+0000] {task_command.py:426} INFO - Running <TaskInstance: etl_yfinance_stock.fetch_and_upsert scheduled__2025-09-23T00:00:00+00:00 [running]> on host 11e1994bdecf
[2025-09-24T00:00:02.692+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='dingyuyao' AIRFLOW_CTX_DAG_ID='etl_yfinance_stock' AIRFLOW_CTX_TASK_ID='fetch_and_upsert' AIRFLOW_CTX_EXECUTION_DATE='2025-09-23T00:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-09-23T00:00:00+00:00'
[2025-09-24T00:00:02.692+0000] {taskinstance.py:430} INFO - ::endgroup::
[2025-09-24T00:00:02.692+0000] {logging_mixin.py:188} INFO - [DEBUG] Date range: 2025-03-28 to 2025-09-24
[2025-09-24T00:00:02.695+0000] {logging_mixin.py:188} INFO - [DEBUG] Stock symbols: ['AAPL', 'MSFT', 'GOOGL', 'TSLA', 'NVDA']
[2025-09-24T00:00:02.695+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for AAPL...
[2025-09-24T00:00:02.695+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-24T00:00:03.403+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for AAPL: (123, 7)
[2025-09-24T00:00:03.404+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for AAPL: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-24T00:00:03.404+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for AAPL:
[2025-09-24T00:00:03.412+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX    VOLUME
0       AAPL 2025-03-28  221.128734  ...  217.148471  223.263508  39818600
1       AAPL 2025-03-31  216.480107  ...  215.702013  225.069084  65299300

[2 rows x 7 columns]
[2025-09-24T00:00:03.413+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for MSFT...
[2025-09-24T00:00:03.413+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-24T00:00:03.658+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for MSFT: (123, 7)
[2025-09-24T00:00:03.658+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for MSFT: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-24T00:00:03.659+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for MSFT:
[2025-09-24T00:00:03.663+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX    VOLUME
0       MSFT 2025-03-28  386.733081  ...  375.621786  387.779455  21632000
1       MSFT 2025-03-31  371.247044  ...  365.965420  375.761320  35184700

[2 rows x 7 columns]
[2025-09-24T00:00:03.664+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for GOOGL...
[2025-09-24T00:00:03.664+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-24T00:00:03.891+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for GOOGL: (123, 7)
[2025-09-24T00:00:03.891+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for GOOGL: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-24T00:00:03.891+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for GOOGL:
[2025-09-24T00:00:03.896+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX    VOLUME
0      GOOGL 2025-03-28  160.152719  ...  153.307135  161.479925  48669300
1      GOOGL 2025-03-31  152.788219  ...  150.343371  155.213105  54603500

[2 rows x 7 columns]
[2025-09-24T00:00:03.896+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for TSLA...
[2025-09-24T00:00:03.897+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-24T00:00:04.100+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for TSLA: (123, 7)
[2025-09-24T00:00:04.100+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for TSLA: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-24T00:00:04.100+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for TSLA:
[2025-09-24T00:00:04.103+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX     VOLUME
0       TSLA 2025-03-28  275.579987  ...  260.570007  276.100006  123809400
1       TSLA 2025-03-31  249.309998  ...  243.360001  260.559998  134008900

[2 rows x 7 columns]
[2025-09-24T00:00:04.104+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for NVDA...
[2025-09-24T00:00:04.105+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-24T00:00:04.389+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for NVDA: (123, 7)
[2025-09-24T00:00:04.390+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for NVDA: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-24T00:00:04.390+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for NVDA:
[2025-09-24T00:00:04.396+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX     VOLUME
0       NVDA 2025-03-28  111.475975  ...  109.056281  112.855806  229872500
1       NVDA 2025-03-31  105.116772  ...  103.636963  110.946041  299212700

[2 rows x 7 columns]
[2025-09-24T00:00:04.397+0000] {logging_mixin.py:188} INFO - [DEBUG] Combined data shape: (615, 7)
[2025-09-24T00:00:04.397+0000] {logging_mixin.py:188} INFO - [DEBUG] Combined data columns: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-24T00:00:04.400+0000] {logging_mixin.py:188} INFO - [DEBUG] NaN count per column:
[2025-09-24T00:00:04.401+0000] {logging_mixin.py:188} INFO - Price
SYMBOL    0
DATE      0
OPEN      0
CLOSE     0
MIN       0
MAX       0
VOLUME    0
dtype: int64
[2025-09-24T00:00:04.402+0000] {logging_mixin.py:188} INFO - [DEBUG] Final data shape: (615, 7)
[2025-09-24T00:00:04.402+0000] {logging_mixin.py:188} INFO - [DEBUG] Final data sample:
[2025-09-24T00:00:04.406+0000] {logging_mixin.py:188} INFO - Price SYMBOL        DATE        OPEN  ...         MIN         MAX     VOLUME
0       AAPL  2025-03-28  221.128734  ...  217.148471  223.263508   39818600
1       AAPL  2025-03-31  216.480107  ...  215.702013  225.069084   65299300
2       AAPL  2025-04-01  219.273268  ...  218.365486  223.133813   36412700
3       AAPL  2025-04-02  220.779591  ...  220.480320  224.640136   35905900
4       AAPL  2025-04-03  205.038116  ...  200.758597  206.983366  103419000

[5 rows x 7 columns]
[2025-09-24T00:00:04.414+0000] {base.py:84} INFO - Using connection ID 'snowflake_default' for task execution.
[2025-09-24T00:00:04.414+0000] {connection.py:408} INFO - Snowflake Connector for Python Version: 3.11.0, Python Version: 3.12.4, Platform: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[2025-09-24T00:00:04.414+0000] {connection.py:1258} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-09-24T00:00:05.716+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:05.892+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:06.057+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:06.164+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:06.307+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:06.308+0000] {logging_mixin.py:188} INFO - [ctx] version=9.28.1, wh=BEETLE_QUERY_WH, role=TRAINING_ROLE, db=ASH_DB, schema=STOCK_SCHEMA
[2025-09-24T00:00:07.924+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:07.925+0000] {logging_mixin.py:188} INFO - [DEBUG] Prepared 615 rows for insertion
[2025-09-24T00:00:07.926+0000] {logging_mixin.py:188} INFO - [DEBUG] First row sample: {'SYMBOL': 'AAPL', 'DATE': datetime.date(2025, 3, 28), 'OPEN': 221.12873402087155, 'CLOSE': 217.36793518066406, 'MIN': 217.1484711493609, 'MAX': 223.26350805320467, 'VOLUME': 39818600}
[2025-09-24T00:00:11.236+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-24T00:00:11.236+0000] {logging_mixin.py:188} INFO - [fetch_and_upsert] Upserted 615 rows into fact_stock_price_daily.
[2025-09-24T00:00:11.236+0000] {connection.py:773} INFO - closed
[2025-09-24T00:00:11.301+0000] {connection.py:779} INFO - No async queries seem to be running, deleting session
[2025-09-24T00:00:11.442+0000] {python.py:237} INFO - Done. Returned value was: 615
[2025-09-24T00:00:11.443+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2025-09-24T00:00:11.452+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=etl_yfinance_stock, task_id=fetch_and_upsert, run_id=scheduled__2025-09-23T00:00:00+00:00, execution_date=20250923T000000, start_date=20250924T000002, end_date=20250924T000011
[2025-09-24T00:00:11.498+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2025-09-24T00:00:11.505+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-09-24T00:00:11.506+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
