[2025-09-29T00:15:07.256+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2025-09-29T00:15:07.276+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_yfinance_stock.fetch_and_upsert scheduled__2025-09-28T00:00:00+00:00 [queued]>
[2025-09-29T00:15:07.289+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_yfinance_stock.fetch_and_upsert scheduled__2025-09-28T00:00:00+00:00 [queued]>
[2025-09-29T00:15:07.290+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 2
[2025-09-29T00:15:07.308+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): fetch_and_upsert> on 2025-09-28 00:00:00+00:00
[2025-09-29T00:15:07.331+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'etl_yfinance_stock', 'fetch_and_upsert', 'scheduled__2025-09-28T00:00:00+00:00', '--job-id', '432', '--raw', '--subdir', 'DAGS_FOLDER/etl_yfinance_stock.py', '--cfg-path', '/tmp/tmpc499joq0']
[2025-09-29T00:15:07.333+0000] {standard_task_runner.py:91} INFO - Job 432: Subtask fetch_and_upsert
[2025-09-29T00:15:07.337+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=32839) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2025-09-29T00:15:07.341+0000] {standard_task_runner.py:64} INFO - Started process 32854 to run task
[2025-09-29T00:15:07.416+0000] {task_command.py:426} INFO - Running <TaskInstance: etl_yfinance_stock.fetch_and_upsert scheduled__2025-09-28T00:00:00+00:00 [running]> on host 11e1994bdecf
[2025-09-29T00:15:07.804+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='dingyuyao' AIRFLOW_CTX_DAG_ID='etl_yfinance_stock' AIRFLOW_CTX_TASK_ID='fetch_and_upsert' AIRFLOW_CTX_EXECUTION_DATE='2025-09-28T00:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-09-28T00:00:00+00:00'
[2025-09-29T00:15:07.807+0000] {taskinstance.py:430} INFO - ::endgroup::
[2025-09-29T00:15:07.808+0000] {logging_mixin.py:188} INFO - [DEBUG] Date range: 2025-04-02 to 2025-09-29
[2025-09-29T00:15:07.819+0000] {logging_mixin.py:188} INFO - [DEBUG] Stock symbols: ['AAPL', 'MSFT', 'GOOGL', 'TSLA', 'NVDA']
[2025-09-29T00:15:07.820+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for AAPL...
[2025-09-29T00:15:07.824+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-29T00:15:08.585+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for AAPL: (123, 7)
[2025-09-29T00:15:08.586+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for AAPL: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-29T00:15:08.586+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for AAPL:
[2025-09-29T00:15:08.601+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX     VOLUME
0       AAPL 2025-04-02  220.779606  ...  220.480335  224.640152   35905900
1       AAPL 2025-04-03  205.038100  ...  200.758582  206.983351  103419000

[2 rows x 7 columns]
[2025-09-29T00:15:08.602+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for MSFT...
[2025-09-29T00:15:08.603+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-29T00:15:09.421+0000] {multi.py:185} ERROR - 
1 Failed download:
[2025-09-29T00:15:09.422+0000] {multi.py:198} ERROR - ['MSFT']: ConnectionError('Failed to perform, curl: (56) Connection closed abruptly. See https://curl.se/libcurl/c/libcurl-errors.html first for more details.')
[2025-09-29T00:15:09.424+0000] {logging_mixin.py:188} INFO - [fetch_and_upsert] No data for symbol: MSFT
[2025-09-29T00:15:09.425+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for GOOGL...
[2025-09-29T00:15:09.425+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-29T00:15:09.683+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for GOOGL: (123, 7)
[2025-09-29T00:15:09.683+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for GOOGL: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-29T00:15:09.683+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for GOOGL:
[2025-09-29T00:15:09.689+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX    VOLUME
0      GOOGL 2025-04-02  154.823918  ...  154.374867  158.077077  25041700
1      GOOGL 2025-04-03  150.792408  ...  150.073921  152.458897  46883400

[2 rows x 7 columns]
[2025-09-29T00:15:09.690+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for TSLA...
[2025-09-29T00:15:09.690+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-29T00:15:09.958+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for TSLA: (123, 7)
[2025-09-29T00:15:09.959+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for TSLA: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-29T00:15:09.959+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for TSLA:
[2025-09-29T00:15:09.961+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX     VOLUME
0       TSLA 2025-04-02  254.600006  ...  251.270004  284.989990  212787800
1       TSLA 2025-04-03  265.290009  ...  261.510010  276.299988  136174300

[2 rows x 7 columns]
[2025-09-29T00:15:09.961+0000] {logging_mixin.py:188} INFO - [DEBUG] Fetching data for NVDA...
[2025-09-29T00:15:09.961+0000] {warnings.py:112} WARNING - /opt/***/dags/etl_yfinance_stock.py:41: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(symbol, start = start_date.isoformat(), end = end_date.isoformat(), progress = False)

[2025-09-29T00:15:10.214+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed data shape for NVDA: (123, 7)
[2025-09-29T00:15:10.214+0000] {logging_mixin.py:188} INFO - [DEBUG] Processed columns for NVDA: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-29T00:15:10.214+0000] {logging_mixin.py:188} INFO - [DEBUG] Sample data for NVDA:
[2025-09-29T00:15:10.216+0000] {logging_mixin.py:188} INFO - Price SYMBOL       DATE        OPEN  ...         MIN         MAX     VOLUME
0       NVDA 2025-04-02  107.276502  ...  106.776565  111.965914  220601200
1       NVDA 2025-04-03  103.496985  ...  101.587222  105.616713  338769400

[2 rows x 7 columns]
[2025-09-29T00:15:10.217+0000] {logging_mixin.py:188} INFO - [DEBUG] Combined data shape: (492, 7)
[2025-09-29T00:15:10.217+0000] {logging_mixin.py:188} INFO - [DEBUG] Combined data columns: ['SYMBOL', 'DATE', 'OPEN', 'CLOSE', 'MIN', 'MAX', 'VOLUME']
[2025-09-29T00:15:10.218+0000] {logging_mixin.py:188} INFO - [DEBUG] NaN count per column:
[2025-09-29T00:15:10.218+0000] {logging_mixin.py:188} INFO - Price
SYMBOL    0
DATE      0
OPEN      0
CLOSE     0
MIN       0
MAX       0
VOLUME    0
dtype: int64
[2025-09-29T00:15:10.219+0000] {logging_mixin.py:188} INFO - [DEBUG] Final data shape: (492, 7)
[2025-09-29T00:15:10.219+0000] {logging_mixin.py:188} INFO - [DEBUG] Final data sample:
[2025-09-29T00:15:10.221+0000] {logging_mixin.py:188} INFO - Price SYMBOL        DATE        OPEN  ...         MIN         MAX     VOLUME
0       AAPL  2025-04-02  220.779606  ...  220.480335  224.640152   35905900
1       AAPL  2025-04-03  205.038100  ...  200.758582  206.983351  103419000
2       AAPL  2025-04-04  193.416569  ...  186.882560  199.391949  125910900
3       AAPL  2025-04-07  176.767314  ...  174.193612  193.675923  160466300
4       AAPL  2025-04-08  186.244107  ...  168.796824  189.875218  120859500

[5 rows x 7 columns]
[2025-09-29T00:15:10.228+0000] {base.py:84} INFO - Using connection ID 'snowflake_default' for task execution.
[2025-09-29T00:15:10.229+0000] {connection.py:408} INFO - Snowflake Connector for Python Version: 3.11.0, Python Version: 3.12.4, Platform: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[2025-09-29T00:15:10.230+0000] {connection.py:1258} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-09-29T00:15:10.698+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:10.897+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:11.072+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:11.188+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:11.416+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:11.417+0000] {logging_mixin.py:188} INFO - [ctx] version=9.29.0, wh=BEETLE_QUERY_WH, role=TRAINING_ROLE, db=ASH_DB, schema=STOCK_SCHEMA
[2025-09-29T00:15:12.465+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:12.476+0000] {logging_mixin.py:188} INFO - [DEBUG] Prepared 492 rows for insertion
[2025-09-29T00:15:12.478+0000] {logging_mixin.py:188} INFO - [DEBUG] First row sample: {'SYMBOL': 'AAPL', 'DATE': datetime.date(2025, 4, 2), 'OPEN': 220.7796058888877, 'CLOSE': 223.34332275390625, 'MIN': 220.48033536050963, 'MAX': 224.64015156252358, 'VOLUME': 35905900}
[2025-09-29T00:15:14.428+0000] {cursor.py:1149} INFO - Number of results in first chunk: 1
[2025-09-29T00:15:14.428+0000] {logging_mixin.py:188} INFO - [fetch_and_upsert] Upserted 492 rows into fact_stock_price_daily.
[2025-09-29T00:15:14.428+0000] {connection.py:773} INFO - closed
[2025-09-29T00:15:14.504+0000] {connection.py:779} INFO - No async queries seem to be running, deleting session
[2025-09-29T00:15:14.643+0000] {python.py:237} INFO - Done. Returned value was: 492
[2025-09-29T00:15:14.644+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2025-09-29T00:15:14.663+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=etl_yfinance_stock, task_id=fetch_and_upsert, run_id=scheduled__2025-09-28T00:00:00+00:00, execution_date=20250928T000000, start_date=20250929T001507, end_date=20250929T001514
[2025-09-29T00:15:14.703+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2025-09-29T00:15:14.709+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-09-29T00:15:14.710+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
